(function(d,m,u,t,S,I,l,g,x,_,U,b,L,B){"use strict";const F="https://api.deeplx.org/translate";var C={translate:async function(e,i="auto",a,n=!1){try{if(n)return{source_lang:i,text:e};const r=await(await fetch(F,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,source_lang:i,target_lang:a})})).json();if(r.code!==200)throw Error(`Failed to translate text from DeepL: ${r.message}`);return{source_lang:i,text:r.data}}catch(r){throw Error(`Failed to fetch from DeepL: ${r}`)}}};const v=u.findByProps("openLazy","hideActionSheet"),D=u.findByProps("ActionSheetRow")?.ActionSheetRow??g.Forms.FormRow,G=u.findByStoreName("MessageStore"),$=u.findByStoreName("ChannelStore"),k=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:I.semanticColors.INTERACTIVE_NORMAL}});let h=[];function H(){return S.before("openLazy",v,function([e,i,a]){const n=a?.message;i!=="MessageLongPressActionSheet"||!n||e.then(function(r){const p=S.after("default",r,function(le,te){t.React.useEffect(function(){return function(){p()}},[]);const y=x.findInReactTree(te,function(s){return s?.[0]?.type?.name==="ButtonRow"});if(!y)return;const ne=Math.max(y.findIndex(function(s){return s.props.message===t.i18n.Messages.MARK_UNREAD}),0),c=G.getMessage(n.channel_id,n.id);if(!c?.content&&!n.content)return;const N=c?.id??n.id,ae=c?.content??n.content,R=h.find(function(s){return Object.keys(s)[0]===N},"cache object"),A=R?"Revert":"Translate",E=A==="Translate"?l.getAssetIDByName("ic_locale_24px"):l.getAssetIDByName("ic_highlight"),re=async function(){try{const s=o.target_lang,f=A==="Translate",ie=await C.translate(c.content,void 0,s,!f);t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...c,content:`${f?ie.text:R[N]} ${f?`\`[${s?.toLowerCase()}]\``:""}`,guild_id:$.getChannel(c.channel_id).guild_id},log_edit:!1}),f?h.unshift({[N]:ae}):h=h.filter(function(se){return se!==R},"cached data override")}catch(s){B.showToast("Failed to translate message. Please check Debug Logs for more info.",l.getAssetIDByName("Small")),_.logger.error(s)}finally{return v.hideActionSheet()}};y.splice(ne,0,t.React.createElement(D,{label:`${A} Message`,icon:t.React.createElement(D.Icon,{source:E,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:k.iconComponent,source:E})}}),onPress:re}))})})})}var j=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),O=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),V=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),M={arabic:"AR",bulgarian:"BG",czech:"CS",danish:"DA",german:"DE",greek:"EL",english:"EN",spanish:"ES",estonian:"ET",finnish:"FI",french:"FR",hungarian:"HU",indonesian:"ID",italian:"IT",japanese:"JA",korean:"KO",lithuanian:"LT",latvian:"LV",norwegian:"NO",dutch:"NL",polish:"PL",portuguese:"PT",romanian:"RO",russian:"RU",slovak:"SK",slovenian:"SL",swedish:"SV",turkish:"TR",ukrainian:"UK","chinese-simplified":"ZH"};const z=u.findByProps("sendBotMessage"),K=Object.entries(M).map(function([e,i]){return{name:e,displayName:e,value:i}});function X(){return U.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen, using the DeepL Translate API.",displayDescription:"Send a message using Dislate in any language chosen, using the DeepL Translate API.",applicationId:"-1",type:V.CHAT,inputType:j.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:O.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:O.STRING,choices:[...K],required:!0}],async execute(e,i){const[a,n]=e;try{const r=await C.translate(a.value,null,n.value);return await new Promise(function(p){return b.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(g.Codeblock,null,r.text),confirmText:"Yep, send it!",onConfirm:function(){return p({content:r.text})},cancelText:"Nope, don't send it"})})}catch(r){return _.logger.error(r),z.sendBotMessage(i.channel.id,"Failed to translate message. Please check Debug Logs for more info.",l.getAssetIDByName("Small"))}}})}const{FormRow:P}=g.Forms,{ScrollView:Y}=t.ReactNative;function q(){L.useProxy(o);const[e,i]=t.React.useState("");return t.React.createElement(Y,{style:{flex:1}},t.React.createElement(g.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(a){i(a)}}),Object.entries(M).filter(function([a,n]){return a.includes(e)}).map(function([a,n]){return t.React.createElement(P,{label:a,trailing:function(){return t.React.createElement(P.Arrow,null)},onPress:function(){o.target_lang!=n&&(o.target_lang=n,B.showToast(`Saved ToLang to ${a}`,l.getAssetIDByName("check")))}})}))}const{ScrollView:J,Text:Z}=t.ReactNative,{FormRow:T}=g.Forms,Q=t.stylesheet.createThemedStyleSheet({subheaderText:{color:I.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:14}});function W(){const e=t.NavigationNative.useNavigation();return L.useProxy(o),t.React.createElement(J,null,t.React.createElement(T,{label:"Translate to",subLabel:o.target_lang?.toLowerCase(),leading:t.React.createElement(T.Icon,{source:l.getAssetIDByName("ic_activity_24px")}),trailing:function(){return t.React.createElement(T.Arrow,null)},onPress:function(){return e.push("VendettaCustomPage",{title:"Translate to",render:q})}}),t.React.createElement(Z,{style:Q.subheaderText,onPress:function(){return t.url.openURL("https://github.com/aeongdesu/vdplugins")}},`Build: (${m.manifest.hash.substring(0,7)})`))}const o=m.storage;o.target_lang??(o.target_lang="EN");let w=[];var ee={onLoad:function(){return w=[H(),X()]},onUnload:function(){for(const e of w)e()},settings:W};return d.default=ee,d.settings=o,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
